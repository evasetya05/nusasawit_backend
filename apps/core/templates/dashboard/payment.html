{% extends 'dashboard/base.html' %}
{% load static %}
{% block sidebar %}{% endblock %}
{% block main %}
<main class="overflow-auto d-flex flex-column" style="background-color: #E0E8F3; min-height: 100%">
  <div class="container py-5 flex-grow-1">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="mb-0">Pembayaran</h2>
      <a href="{% url 'checkout' %}" class="btn btn-outline-secondary">Kembali ke Checkout</a>
    </div>

    <div class="row g-4">
      <div class="col-12 col-lg-8">
        <div class="card shadow-sm border-0">
          <div class="card-body">
            <h5 class="card-title">Ringkasan Order</h5>
            {% if order %}
              <div class="mb-3">
                <div><strong>Perusahaan:</strong> {{ user.company|default:"-" }}</div>
                <div><strong>Email:</strong> {{ user.email|default:"-" }}</div>
                <div><strong>Siklus Penagihan:</strong> {{ order.billing_cycle|default:"monthly"|title }}</div>
              </div>
              <ul class="list-group list-group-flush mb-3">
                <li class="list-group-item d-flex justify-content-between"><span>Pro (Biaya dasar)</span><span>Rp{{ order.base_price|floatformat:0 }}</span></li>
                {% if order.user_pack_price and order.user_pack_price|add:0 > 0 %}
                <li class="list-group-item d-flex justify-content-between"><span>Paket Pengguna</span><span>Rp{{ order.user_pack_price|floatformat:0 }}</span></li>
                {% endif %}
                {% for m in order.modules %}
                  <li class="list-group-item d-flex justify-content-between"><span>{{ m.name }}</span><span>Rp{{ m.price|floatformat:0 }}</span></li>
                {% endfor %}
              </ul>
              <div class="d-flex justify-content-between fs-5">
                <strong>Total {% if order.billing_cycle == 'yearly' %}per tahun{% else %}per bulan{% endif %}</strong>
                <strong>Rp{{ order.total_price|floatformat:0 }}</strong>
              </div>
            {% else %}
              <div class="alert alert-info">Tidak ada order di sesi. Silakan kembali ke checkout.</div>
            {% endif %}

            <hr>

            <form method="post" action="{% url 'payment' %}" enctype="multipart/form-data">
              {% csrf_token %}
              <input type="hidden" name="confirm_payment" value="1">
              <div class="mb-3">
                <label for="receipt" class="form-label">Upload Bukti Transfer (opsional)</label>
                <input class="form-control" type="file" id="receipt" name="receipt" accept="image/*,application/pdf">
                <div class="form-text">Format yang didukung: JPG, PNG, PDF. Maksimal 5MB.</div>
              </div>
              <button class="btn btn-primary" type="submit" {% if not order %}disabled{% endif %}>Konfirmasi Pembayaran</button>
              <a href="{% url 'pricing' %}" class="btn btn-outline-secondary">Batalkan</a>
            </form>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-4">
        <div class="card shadow-sm border-0">
          <div class="card-body">
            <h5 class="card-title">Metode Pembayaran</h5>
            <p class="text-muted small mb-2">Silakan transfer ke rekening berikut untuk menyelesaikan pembayaran:</p>
            <ul class="small mb-0">
              <li>Transfer Bank (BRI) <strong>0071-01-003606-56-3</strong> <br/> a/n <strong>PT. SDM Portabel Nusantara</strong></li>
            </ul>
            <p class="text-muted small mt-2">Setelah transfer, silakan kirim bukti transfer untuk konfirmasi pembayaran.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% include './partials/footer.html' %}
  {% include './partials/fab.html' %}
</main>
{% endblock %}

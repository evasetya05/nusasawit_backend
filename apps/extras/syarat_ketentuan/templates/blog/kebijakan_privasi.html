{% extends 'dashboard/base.html' %}
{% block content %}
  <div class="container">
    <h1 class="title">Create a New Blog Post</h1>
    {{ form.media }}
    <!-- Success Message Display -->
    {% if messages %}
      <div class="messages">
        {% for message in messages %}<div class="alert alert-{{ message.tags }}">{{ message }}</div>{% endfor %}
      </div>
    {% endif %}
    <form method="post"
          enctype="multipart/form-data"
          class="blog-form"
          onsubmit="return validateImage()">
      {% csrf_token %}
      <div class="form-group">
        <label for="id_title">Title:</label>
        {{ form.title }}
      </div>
      <div class="form-group">
        <label for="id_content">Content:</label>
        {{ form.content }}
      </div>
      <!-- ✅ Image Upload Input with Validation -->
      <div class="form-group">
        <label for="id_image">Upload Image:</label>
        <input type="file" name="image" id="id_image" accept="image/*">
        <p id="image-error" style="color: red;"></p>
        <!-- ✅ Show validation errors -->
      </div>
      <button type="submit" class="submit-button">Create Blog</button>
    </form>
  </div>
  <!-- ✅ JavaScript for Image Validation (Size & Dimensions) -->
  <script>
        function validateImage() {
            var fileInput = document.getElementById('id_image');
            var file = fileInput.files[0];
            var errorMessage = document.getElementById("image-error");

            // ✅ No file uploaded, allow form submission
            if (!file) return true;

            var maxSize = 1 * 1024 * 1024; // 2MB limit
            if (file.size > maxSize) {
                errorMessage.textContent = "Ukuran gambar tidak boleh lebih dari 1MB.";
                fileInput.value = ""; // Clear input field
                return false;
            }

            var img = new Image();
            img.src = URL.createObjectURL(file);
            img.onload = function() {
                var maxWidth = 1920;
                var maxHeight = 1080;
                if (img.width > maxWidth || img.height > maxHeight) {
                    errorMessage.textContent = `Dimensi gambar tidak boleh lebih dari ${maxWidth}x${maxHeight} piksel.`;
                    fileInput.value = "";
                    return false;
                }
            };

            return true;
        }
  </script>
  <style>
        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 25px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }

        .title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 26px;
            font-weight: bold;
        }

        .messages {
            margin-bottom: 15px;
        }

        .alert {
            padding: 12px;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .blog-form .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .form-group textarea,
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 18px;
        }

        .form-group textarea {
            min-height: 250px;
            resize: vertical;
        }

        .submit-button {
            display: block;
            width: 100%;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: 0.3s;
        }

        .submit-button:hover {
            background: #0056b3;
        }
  </style>
{% endblock %}

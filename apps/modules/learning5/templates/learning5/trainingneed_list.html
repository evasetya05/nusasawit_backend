{% extends 'dashboard/base.html' %}


{% block content %}



<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Analisis Kebutuhan Pelatihan (AKP)</h2>
    <div>
      <a href="{% url 'learning5:trainingneed_add' %}" class="btn btn-primary">Tambah AKP</a>
    </div>
  </div>

  {% if grouped_needs %}
    {% for employee_name, needs in grouped_needs.items %}
      <div class="card mb-4 shadow-sm">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <h5 class="mb-0">{{ employee_name }}</h5>
          <span class="badge text-bg-secondary">{{ needs|length }} AKP</span>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-striped table-bordered mb-0">
              <thead class="table-light">
                <tr>
                  <th>Kompetensi</th>
                  <th>Kompetensi (Detail)</th>
                  <th>Skor Sekarang</th>
                  <th>Skor Diinginkan</th>
                  <th>Rencana Waktu Pelatihan</th>
                  <th>Jenis Pelatihan (detail)</th>
                  <th>Sudah dilaksanakan</th>
                  <th>Biaya</th>
                  <th>Keterangan</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody>
                {% for n in needs %}
                <tr>
                  <td>{{ n.competency.name }}</td>
                  <td>{{ n.detail_competency.name|default:"-" }}</td>
                  <td>{{ n.current_score|default:"-" }}</td>
                  <td>{{ n.desired_score|default:"-" }}</td>
                  <td>{{ n.when_to_traine|date:"Y-m-d"|default:"-" }}</td>
                  <td>{{ n.jenis_pelatihan|default:"-" }}</td>
                  <td>{{ n.done_at|date:"Y-m-d"|default:"-" }}</td>
                  <td>{{ n.cost|default:"-" }}</td>
                  <td>{{ n.notes|default:"-" }}</td>
                  <td>

                    <a href="{% url 'learning5:trainingneed_edit' n.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
                    {% if is_owner %}
                      <form method="post" action="{% url 'learning5:trainingneed_delete' n.id %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Hapus AKP ini?');">Hapus</button>
                      </form>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="alert alert-info">Belum ada AKP untuk ditampilkan.</div>
  {% endif %}
</div>
{% endblock %}
